package com.inhyuk.lango.level.prompt

class LevelTestEvalGuidePrompt {
    companion object{
        fun getTestEvaluationSystemPrompt(): String {
            return """
                <Level Test Evaluation Guideline>
                    학습자의 정확한 CEFR 레벨(A1.1~C2.3)을 평가하기 위한 문제와 학습자의 답안지가 준비되어 있습니다.
                    그 내용을 보고 학습자의 CEFR 레벨을 평가하세요.
                    
                    CEFR 레벨에 대한 설명은 아래 Level Description을 참고하세요.
                    <Level Description>
                        ${CEFRLevelPrompt.Description}
                    </Level Description>
                    
                    각 문제 유형에 대한 평가 절차는 다음과 같습니다.
                    <Evaluation Guideline>
                        # 평가 절차
                        
                        ## 1단계: 객관식 채점 (어휘 + 문법 + 독해)
                        
                        각 문제별로:
                        - 정답 여부 확인
                        - 레벨별 정답률 계산
                        - 오답 패턴 분석
                        
                        **레벨별 정답률 계산**:
                        - A1 레벨 문제: ___개 중 ___개 정답 (___%)
                        - A2 레벨 문제: ___개 중 ___개 정답 (___%)
                        - B1 레벨 문제: ___개 중 ___개 정답 (___%)
                        - B2 레벨 문제: ___개 중 ___개 정답 (___%)
                        - C1 레벨 문제: ___개 중 ___개 정답 (___%)
                        
                        **분석 기준**:
                        - 특정 레벨 80% 이상 정답: 해당 레벨 확실히 통과
                        - 50-79% 정답: 해당 레벨 학습 중
                        - 50% 미만: 해당 레벨 미달
                        
                        ## 2단계: 작문 평가
                        
                        각 작문에 대해 다음을 분석:
                        
                        ### 어휘 분석
                        1. 사용된 고유 단어 수 계산
                        2. 각 단어의 빈도 레벨 확인
                           - A1: 500 이하
                           - A2: 501-2000
                           - B1: 2001-4000
                           - B2: 4001-7000
                           - C1: 7001-13000
                           - C2: 13001+
                        3. 어휘 범위 점수 산출
                        
                        **어휘 레벨 판정**:
                        - 90% 이상이 특정 레벨 이하 → 그 레벨로 판정
                        - 예: 90%가 A2 레벨 어휘 → A2로 판정
                        
                        ### 문법 분석
                        1. 사용된 모든 문법 구조 목록화
                        2. 각 구조를 CEFR 레벨에 매핑
                        3. 오류 식별 및 분류
                        
                        **문법 레벨 판정**:
                        - 정확하게 사용된 가장 높은 레벨 문법 확인
                        - 예: 수동태를 정확히 사용 → 최소 B1
                        - 예: 도치 구문을 정확히 사용 → 최소 B2
                        
                        **오류 심각도**:
                        - 경미한 오류 (레벨 유지): 철자, 관사, 단순 실수
                        - 중간 오류 (레벨 하향 고려): 시제 혼동, 어순
                        - 심각한 오류 (레벨 하향): 문법 구조 붕괴, 의미 불명
                        
                        ### 문장 구조 분석
                        1. 평균 문장 길이 계산
                        2. 문장 유형 분류
                           - 단문 (simple)
                           - 중문 (compound - and/but/or)
                           - 복문 (complex - when/if/because/that)
                        3. 복잡도 점수
                        
                        **구조 레벨 판정**:
                        | 평균 길이 | 복문 비율 | 추정 레벨 |
                        |----------|----------|----------|
                        | 5-10단어 | 0-20% | A1-A2 |
                        | 10-15단어 | 20-40% | B1 |
                        | 15-20단어 | 40-60% | B2 |
                        | 20+단어 | 60%+ | C1-C2 |
                        
                        ### 응집성 평가
                        1. 연결어 사용 확인
                           - A1-A2: and, but, because
                           - B1: however, therefore, although
                           - B2: nevertheless, furthermore, whereas
                           - C1+: notwithstanding, consequently, insofar as
                        2. 문단 구성 논리성
                        3. 주제 일관성
                        
                        ## 3단계: 종합 레벨 판정
                        
                        **판정 알고리즘**:
                        
                        1. **객관식 기준 레벨** 산출
                           - 80% 이상 통과한 가장 높은 레벨 = 기준 레벨
                           - 예: A1 90%, A2 85%, B1 75% → A2가 기준
                        
                        2. **작문 기준 레벨** 산출
                           - 어휘 레벨, 문법 레벨, 구조 레벨 중 중간값
                           - 예: 어휘 B1, 문법 A2, 구조 B1 → B1
                        
                        3. **최종 레벨 결정**
                           - 객관식과 작문 레벨이 같으면: 그 레벨
                           - 1단계 차이: 낮은 레벨 (안전하게)
                           - 2단계 이상 차이: 객관식 레벨 우선 (작문은 변동성 큼)
                        
                        4. **세부 단계 결정** (.1, .2, .3)
                           - 해당 메이저 레벨 문제 정답률로 판단
                           - 60-70%: .1 단계
                           - 70-85%: .2 단계
                           - 85%+: .3 단계
                           
                       ## 중요 판정 원칙
                       1. **보수적 평가**: 불확실하면 낮은 레벨로
                       2. **일관성 중시**: 한 영역만 높으면 레벨 상향 불가
                       3. **안정성 확인**: 해당 레벨 문제 80% 이상 정답 필수
                       4. **오류 심각도 고려**: 경미한 오류는 레벨에 영향 없음
                       5. **맥락 파악**: 실수 vs 모르는 것 구분
                    </Evaluation Guideline>
                    
                    <Test And Answer>
                        
                    </Test And Answer>
                    
                </Level Test Evaluation Guideline>
            """.trimIndent()
        }
    }
}